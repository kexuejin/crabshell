{"id":"android-0qh","title":"Port latest hardening commits onto main","description":"Cherry-pick the latest validated commits from history-sanitize/no-thirdparty onto main so development continues on main branch.","status":"closed","priority":1,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T10:39:30.130918+08:00","created_by":"kexuejin","updated_at":"2026-02-13T14:26:37.19372+08:00","closed_at":"2026-02-13T14:26:37.19372+08:00","close_reason":"Closed"}
{"id":"android-27s","title":"Remove stale Java dex-loaded flag gating","description":"Eliminate Java-side sDexLoaded gating and rely on native atomic marker to avoid false-loaded state after failed native load.","status":"closed","priority":1,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T10:14:57.043899+08:00","created_by":"kexuejin","updated_at":"2026-02-13T10:17:48.776962+08:00","closed_at":"2026-02-13T10:17:48.776962+08:00","close_reason":"Removed Java-side stale dex-loaded flag and relied on native atomic gating; validated by tests and emulator packaging/install checks"}
{"id":"android-4t9","title":"Harden ptrace errno handling in native anti-debug path","description":"Replace unwrap_or(0) errno fallback with explicit Option handling to avoid masking ptrace failures and improve diagnostics.","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T10:21:57.124817+08:00","created_by":"kexuejin","updated_at":"2026-02-13T10:31:00.347301+08:00","closed_at":"2026-02-13T10:31:00.347301+08:00","close_reason":"Replaced ptrace errno unwrap_or fallback with explicit Option handling and added guard test; validated via tests and emulator packaging/install checks"}
{"id":"android-6wz","title":"Add end-to-end emulator validation for mmkv-enabled target app","description":"Current tests verify packaging-level behavior for mmkv (no default keep, artifact replacement/encryption). Add a real sample target app that includes mmkv, run pack.py, install hardened output on emulator, and assert startup/read-write path remains healthy.","status":"open","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T16:10:47.115242+08:00","created_by":"kexuejin","updated_at":"2026-02-13T16:10:47.115242+08:00"}
{"id":"android-7ut","title":"降低ShellComponentFactory误报级别","description":"将 ShellComponentFactory 正常路径的 Log.e 降为 Log.d，异常路径改为 Log.w，减少误报噪音和无效告警。","notes":"实现：将 ShellComponentFactory 中 constructor/instantiate*/delegate 正常流程日志从 Log.e 改为 Log.d，保留异常路径为 Log.w。\\n验证：scripts/validate_fixture_apps.sh（构建、加固、安装启动、logcat 校验全部通过）。","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T07:21:06.657911+08:00","created_by":"kexuejin","updated_at":"2026-02-13T07:21:13.887753+08:00","closed_at":"2026-02-13T07:21:13.887753+08:00","close_reason":"implemented and validated via full fixture pipeline"}
{"id":"android-7xb","title":"Refine packcore bindings cleanup","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T09:35:12.118608+08:00","created_by":"kexuejin","updated_at":"2026-02-13T09:39:15.452563+08:00","closed_at":"2026-02-13T09:39:15.452563+08:00","close_reason":"Completed pack_bindings export cleanup with compatibility tests"}
{"id":"android-993","title":"新增一键fixture全链路验证脚本","description":"新增单一入口脚本执行构建、加固、模拟器安装启动与logcat校验，减少人工操作与遗漏风险。","notes":"实现：\\n1) 新增 scripts/validate_fixture_apps.sh，默认串联 build_fixture_apps -\u003e harden_fixture_apps -\u003e 三个受保护产物的 emulator 验证。\\n2) 支持 RUN_HARDEN=0 跳过重复加固，仅重跑安装/启动/logcat 校验。\\n3) ShellComponentFactory 移除 REPLACE_ORIGINAL_FACTORY 旧占位符判断分支。\\n4) README 增补统一验证命令。\\n5) 清理 .beads/issues.jsonl 历史备注中的 Kid/Parent 命名残留，统一为 kapp 命名。\\n\\n验证：\\n- bash -n scripts/build_fixture_apps.sh scripts/harden_fixture_apps.sh scripts/validate_fixture_apps.sh scripts/validate_emulator_install.sh scripts/test_on_emulator.sh\\n- scripts/validate_fixture_apps.sh（通过，日志：/tmp/kappa-validate.log, /tmp/kappb-debug-validate.log, /tmp/kappb-release-validate.log）\\n- rg -n \"com\\.flashget|com\\.example\\.kidapp|com\\.example\\.parentapp|SampleKid|SampleParent|\\bKid\\b|\\bParent\\b\" .（无命中）","status":"closed","priority":1,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T07:11:11.749413+08:00","created_by":"kexuejin","updated_at":"2026-02-13T07:13:22.094794+08:00","closed_at":"2026-02-13T07:11:35.684165+08:00","close_reason":"implemented and verified with full fixture pipeline"}
{"id":"android-cis","title":"Add pack export-surface regression test","description":"Add a test to keep pack module compatibility exports stable while reducing internal namespace leakage.","status":"closed","priority":3,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T09:44:01.191008+08:00","created_by":"kexuejin","updated_at":"2026-02-13T09:44:50.504152+08:00","closed_at":"2026-02-13T09:44:50.504152+08:00","close_reason":"Added and passed export-surface regression test"}
{"id":"android-dgh","title":"Guard shell class-name normalization against placeholders","description":"Reject placeholder/resource class names like  and @string/* in ShellApplication/ShellComponentFactory normalization to avoid runtime ClassNotFound crashes.","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T10:10:45.052415+08:00","created_by":"kexuejin","updated_at":"2026-02-13T10:13:20.984056+08:00","closed_at":"2026-02-13T10:13:20.984056+08:00","close_reason":"Added placeholder/resource guard in class-name normalization and validated via tests plus packaging/emulator checks"}
{"id":"android-eaz","title":"增强GUI输入配置前置校验","description":"在 Tauri 后端增加输入文件存在性/扩展名/输出格式兼容性校验，并补单测，避免无效配置触发运行期失败。","notes":"实现：\\n1) crabshell-gui/src-tauri/src/main.rs 的 validate_hardening_config 增加输入文件存在性/文件类型/.apk|.aab 扩展名校验。\\n2) 增加 output-format=aab 与输入扩展名的兼容校验。\\n3) 增加输出目录存在性校验。\\n4) 新增单测覆盖：missing input、apk 输入配 aab 输出、invalid output-format。\\n\\n验证：scripts/verify_gui_pipeline.sh（check + cargo test + tauri build + smoke 全通过）","status":"closed","priority":1,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T08:33:07.824963+08:00","created_by":"kexuejin","updated_at":"2026-02-13T08:33:55.020277+08:00","closed_at":"2026-02-13T08:33:55.020277+08:00","close_reason":"implemented and verified by gui pipeline"}
{"id":"android-ek2","title":"新增GUI一键验证脚本并完成启动冒烟","description":"新增脚本串联 GUI 配置校验、Rust 单测、Tauri 构建和应用启动冒烟，确保 GUI 配置与运行路径稳定。","notes":"实现：\\n1) 新增 scripts/verify_gui_pipeline.sh，默认执行 GUI check + src-tauri cargo test + tauri build + 启动冒烟（可配置 RUN_NPM_CI/RUN_APP_SMOKE）。\\n2) README 增加 GUI Verification 使用说明。\\n\\n验证：\\n- bash -n scripts/verify_gui_pipeline.sh\\n- scripts/verify_gui_pipeline.sh（通过，生成 CrabShell.app，启动冒烟通过，log: /tmp/crabshell-gui-smoke.log）","status":"closed","priority":1,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T07:41:24.278954+08:00","created_by":"kexuejin","updated_at":"2026-02-13T07:41:33.384849+08:00","closed_at":"2026-02-13T07:41:33.384849+08:00","close_reason":"implemented and verified with automated gui pipeline"}
{"id":"android-f7w","title":"Replace placeholder README demo with 30s real workflow GIF","status":"open","priority":3,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T15:17:55.358879+08:00","created_by":"kexuejin","updated_at":"2026-02-13T15:17:55.358879+08:00"}
{"id":"android-fmg","title":"Harden signing secret handling across pack.py subprocesses and logs","status":"open","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T11:27:53.893409+08:00","created_by":"kexuejin","updated_at":"2026-02-13T11:27:53.893409+08:00"}
{"id":"android-jd2","title":"加强 GUI 配置校验并完成构建验证","description":"为 GUI 端增加配置输入校验和参数构建单元测试，移除未接入的旧硬编码选项组件，并完成前后端构建验证。","notes":"实现：\\n1) crabshell-gui/src-tauri/src/main.rs 新增 validate_hardening_config 与 build_pack_args，统一参数生成并提前校验输入/输出/outputFormat。\\n2) 增加 2 个 Rust 单测覆盖 outputFormat 非法值和参数拼接完整性。\\n3) 删除未接入且与实际后端参数模型不一致的旧组件：crabshell-gui/src/renderer/components/HardeningOptions.tsx。\\n\\n验证：\\n- cd crabshell-gui \u0026\u0026 npm ci\\n- cd crabshell-gui \u0026\u0026 npm run check\\n- cd crabshell-gui/src-tauri \u0026\u0026 cargo test\\n- cd crabshell-gui \u0026\u0026 npm run build:app","status":"closed","priority":1,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T07:30:16.164819+08:00","created_by":"kexuejin","updated_at":"2026-02-13T07:30:24.664482+08:00","closed_at":"2026-02-13T07:30:24.664482+08:00","close_reason":"implemented and GUI build/runtime pipeline verified"}
{"id":"android-o6z","title":"Improve GitHub GEO and add repository topics","description":"Improve repository discoverability by refining README SEO sections and configuring repository topics.","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T10:47:54.112787+08:00","created_by":"kexuejin","updated_at":"2026-02-13T14:26:37.195274+08:00","closed_at":"2026-02-13T14:26:37.195274+08:00","close_reason":"Closed"}
{"id":"android-olh","title":"Optimize manifest patch pipeline to avoid full apktool decode/build on every pack","status":"open","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T11:27:53.893413+08:00","created_by":"kexuejin","updated_at":"2026-02-13T11:27:53.893413+08:00"}
{"id":"android-raf","title":"Improve factory fallback to use target metadata","description":"Make ShellComponentFactory derive fallback delegate from ApplicationInfo/app metadata instead of fixed constant to improve multi-target packaging stability.","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T09:52:29.504129+08:00","created_by":"kexuejin","updated_at":"2026-02-13T09:55:54.119835+08:00","closed_at":"2026-02-13T09:55:54.119835+08:00","close_reason":"Switched factory fallback to metadata+ApplicationInfo reflection and validated via tests+emulator packaging checks"}
{"id":"android-shell-7so","title":"CrabShell 项目优化与稳定性提升","description":"集中管理打包链路、loader 稳定性与 GUI 安全性优化任务","notes":"All child tasks are complete and validated. Final regression pass includes loader rust host checks, GUI checks, Python regression tests, and repeated Kid/Parent build-install-launch verification on emulator-5554. Epic closure reflects completion of optimization and stability goals tracked here.","status":"closed","priority":1,"issue_type":"epic","owner":"kexuejin@gmail.com","created_at":"2026-02-11T20:46:27.676142+08:00","created_by":"kexuejin","updated_at":"2026-02-12T00:29:48.519429+08:00","closed_at":"2026-02-12T00:29:48.519429+08:00","close_reason":"All epic child tasks completed with build/test/emulator validation.","labels":["backlog","optimization"]}
{"id":"android-shell-7so.1","title":"修复 resources.arsc 透传失效","description":"decode_and_patch_target_manifest 返回值错误导致 resources 参数未传给 packer","notes":"修复内容：pack.py 中 decode_and_patch_target_manifest 返回值从 None 改为 resources_arsc，恢复 --resources 透传。\\n验证：1) 复现脚本（monkeypatched apktool）在修复前失败、修复后通过；2) 使用 SampleKid-debug.apk 与 SampleParent-release.aab 各执行一次完整 pack.py 流程，均编译打包成功；3) 产物分别安装到 emulator-5554 并启动，logcat 未发现目标包的 FATAL EXCEPTION/ANR/Fatal signal。","status":"closed","priority":0,"issue_type":"bug","assignee":"kexuejin","owner":"kexuejin@gmail.com","created_at":"2026-02-11T20:46:32.913293+08:00","created_by":"kexuejin","updated_at":"2026-02-11T21:20:11.350904+08:00","closed_at":"2026-02-11T21:20:11.350904+08:00","close_reason":"fixed and validated on emulator","labels":["manifest","packer"],"dependencies":[{"issue_id":"android-shell-7so.1","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T20:46:32.914112+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.10","title":"修复 Parent push 进程重复 Dex 注册导致启动崩溃","description":"Parent 包在启动时 push 进程复现 java.lang.InternalError: Attempt to register dex file ... with multiple class loaders，随后主进程 startup ANR。该问题在 skip-build 修复后仍复现，应作为独立运行时问题跟踪。","notes":"Starting root-cause investigation for push process dex registration crash.\nApplied loader stability changes in loader/app/src/main/rust/src/lib.rs: (1) process-level dex-load guard to skip duplicate native load calls in same process, (2) switched dex landing path to avoid anonymous in-memory dex conflicts, (3) direct addDexPath/addNativePath integration for target classloader to avoid cross-classloader dex element ownership issues, (4) landed dex files as read-only to satisfy runtime dex loading policy.\nValidation (2026-02-11): rebuilt and installed /tmp/protected-kid-bead10-v4.apk + /tmp/protected-parent-bead10-v4.apk on emulator. Prior crash signature 'Attempt to register dex file ... with multiple class loaders' no longer appears in parent main/push processes.","status":"closed","priority":1,"issue_type":"bug","owner":"kexuejin@gmail.com","created_at":"2026-02-11T23:32:29.763354+08:00","created_by":"kexuejin","updated_at":"2026-02-11T23:57:41.110905+08:00","closed_at":"2026-02-11T23:57:41.110905+08:00","close_reason":"Removed repeated dex registration crash path; verified crash signature no longer reproduced on emulator.","dependencies":[{"issue_id":"android-shell-7so.10","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T23:32:29.764211+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.11","title":"修复 Parent 资源缺失导致启动崩溃（drawable/splash）","description":"在修复 dex classloader 冲突后，Parent 进一步启动到 Activity 阶段，但因资源缺失崩溃：Resources: drawable/splash (及 pic_start_logo_title)。日志伴随 injectAssets 指向空 kapp_assets.zip。需定位资源表/资产注入链路。","notes":"Starting root-cause investigation for Parent drawable resources missing at runtime.\nRoot cause evidence: parent crash moved from classloader conflict to resource path after dex fix. Logs showed Resources(drawable/splash) together with empty kapp_assets.zip injection attempts.\nFixes: (1) pack.py now preserves original target resources.arsc by default and only uses rebuilt resources when CRABSHELL_USE_REBUILT_RESOURCES=1. (2) ShellApplication.injectAssets now skips missing/empty/no-entry kapp_assets.zip and treats addAssetPath cookie=0 as no-op.\nValidation (2026-02-12): rebuilt /tmp/protected-kid-bead11.apk and /tmp/protected-parent-bead11.apk; both installed with --no-incremental. Kid launches without FATAL/ANR. Parent launches to ParentGuideActivity; no reproduced FATAL/ANR/ClassNotFound/Resources in follow-up log checks.","status":"closed","priority":1,"issue_type":"bug","owner":"kexuejin@gmail.com","created_at":"2026-02-11T23:57:30.809988+08:00","created_by":"kexuejin","updated_at":"2026-02-12T00:04:45.35007+08:00","closed_at":"2026-02-12T00:04:45.35007+08:00","close_reason":"Resolved parent startup resource crash by preserving original resources.arsc and hardening empty asset-zip injection path; emulator verification passed.","dependencies":[{"issue_id":"android-shell-7so.11","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T23:57:30.810804+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.2","title":"修复 Shell 常量注入与原应用回退逻辑","description":"避免 ORIGINAL_APP/ORIGINAL_FACTORY 依赖硬编码，优先读取 manifest 元数据，确保多目标打包稳定","notes":"修复内容：\\n1) pack.py 的 patch_shell_loader_constants 改为正则替换 ORIGINAL_APP/ORIGINAL_FACTORY 常量定义，不再依赖占位符字符串；\\n2) ShellApplication.onCreate 优先读取 manifest meta-data 的 kapp.original_application，缺失时才回退常量；\\n3) ShellComponentFactory.ensureDelegate 优先读取 kapp.original_factory，缺失时回退常量，并忽略 REPLACE_ORIGINAL_FACTORY 占位值。\\n验证：\\n- 复现脚本（临时 ShellComponentFactory.java）在修复前失败、修复后通过；\\n- SampleKid-debug.apk 与 SampleParent-release.aab 分别执行完整 pack.py（不使用 --skip-build）均成功；\\n- 产物 /tmp/protected-kid-bead2-full.apk 与 /tmp/protected-parent-bead2-full.apk 在 emulator-5554 串行安装并启动，logcat 未检出目标包 Java FATAL/ANR/Fatal signal。\\n附加发现：定位到 --skip-build 路径存在 payload/key 失配风险，已登记 android-shell-7so.9。","status":"closed","priority":0,"issue_type":"bug","assignee":"kexuejin","owner":"kexuejin@gmail.com","created_at":"2026-02-11T20:46:38.150272+08:00","created_by":"kexuejin","updated_at":"2026-02-11T21:51:05.756518+08:00","closed_at":"2026-02-11T21:51:05.756518+08:00","close_reason":"fixed and validated by full build + emulator run","labels":["loader","manifest"],"dependencies":[{"issue_id":"android-shell-7so.2","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T20:46:38.1511+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.3","title":"GUI 日志脱敏处理签名参数","description":"start_hardening 输出命令时屏蔽 --ks-pass 等敏感值","notes":"Implemented CLI log redaction for sensitive signing args in crabshell-gui/src-tauri/src/main.rs via redact_cli_args_for_log(). Added unit test redact_sensitive_cli_args_masks_password_values; cargo check and targeted cargo test pass. Rebuilt/installed protected packages during subsequent verification; no regression tied to this GUI logging change.","status":"closed","priority":1,"issue_type":"bug","assignee":"kexuejin","owner":"kexuejin@gmail.com","created_at":"2026-02-11T20:46:43.39415+08:00","created_by":"kexuejin","updated_at":"2026-02-11T23:22:35.88971+08:00","closed_at":"2026-02-11T23:22:35.88971+08:00","close_reason":"Sensitive signing arguments are now masked in GUI command logs and covered by unit test.","labels":["gui","security"],"dependencies":[{"issue_id":"android-shell-7so.3","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T20:46:43.394967+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.4","title":"对齐 GUI options 与后端实际能力","description":"处理 HardeningOptions 展示与后端参数不一致问题（接线或下线）","notes":"Aligned GUI capability with backend: removed unimplemented HardeningOptions from runtime App flow (frontend no longer exposes non-functional toggles), retained only options that map to pack.py args (advanced + signing). Also fixed UI structure around signing card. Validation: crabshell-gui npm run check passes; src-tauri cargo check passes.","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-11T20:46:48.635548+08:00","created_by":"kexuejin","updated_at":"2026-02-12T00:21:06.569026+08:00","closed_at":"2026-02-12T00:21:06.569026+08:00","close_reason":"GUI options now match backend capabilities; non-functional hardening toggles are removed from active UI.","labels":["gui","ux"],"dependencies":[{"issue_id":"android-shell-7so.4","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T20:46:48.636426+08:00","created_by":"kexuejin"},{"issue_id":"android-shell-7so.4","depends_on_id":"android-shell-7so.2","type":"blocks","created_at":"2026-02-11T20:48:08.509205+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.5","title":"消除 loader 重复 payload 读取","description":"整合 verify_integrity 与 load_dex_core 中重复 extract_payload 调用","notes":"Implemented payload read de-dup in loader rust path: extract_payload(true) now runs once per entrypoint (Application/AppInfo/Provider), verify_integrity handles signature check only, and load_dex_core consumes preloaded payload bytes. This removes repeated APK payload I/O while preserving existing integrity checks and load behavior.","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-11T20:46:53.878661+08:00","created_by":"kexuejin","updated_at":"2026-02-12T00:28:30.821362+08:00","closed_at":"2026-02-12T00:28:30.821362+08:00","close_reason":"Removed duplicate payload extraction by unifying verification/load onto a single extracted payload per process entrypoint; validated with host checks and emulator runtime.","labels":["loader","performance"],"dependencies":[{"issue_id":"android-shell-7so.5","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T20:46:53.879592+08:00","created_by":"kexuejin"},{"issue_id":"android-shell-7so.5","depends_on_id":"android-shell-7so.6","type":"blocks","created_at":"2026-02-11T20:48:08.616887+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.6","title":"修复 loader host 构建与 JNI unwrap 风险","description":"处理 ptrace 平台兼容与关键 JNI 路径错误处理","notes":"Root-cause fixed: ptrace check is now Android-only (host-compatible), and JNI critical paths no longer use unwrap in nativeLoadDex/nativeLoadDexWithAppInfo/provider entrypoints. Added recoverable error handling with marker reset and exception_clear. Validation: (1) loader/app/src/main/rust cargo check + cargo test pass on host; (2) rebuilt protected Kid and Parent packages multiple times; (3) installed on emulator-5554 and launched both packages, no reproduced FATAL EXCEPTION/ANR/Fatal signal/InternalError crash signatures.","status":"closed","priority":1,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-11T20:46:59.125719+08:00","created_by":"kexuejin","updated_at":"2026-02-12T00:20:46.006619+08:00","closed_at":"2026-02-12T00:20:46.006619+08:00","close_reason":"Fixed ptrace host-build incompatibility and JNI unwrap crash risk; validated by host build/tests and emulator runtime checks.","labels":["loader","rust","stability"],"dependencies":[{"issue_id":"android-shell-7so.6","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T20:46:59.126437+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.7","title":"拆分 pack.py 大函数并补回归测试","description":"按 toolchain/build/signing/manifest 拆分 pack.py，并补最小自动化用例","notes":"Refactored pack.py main flow by extracting helpers for parser construction, CLI list normalization, output path/format resolution, keep/encrypt option collection, toolchain build gating, and manifest/AAB preparation. Added regression tests scripts/test_pack_main_helpers.py for helper behavior and kept existing skip-build regression tests. Validation: python unittest (6 tests), pack.py --help, repeated Kid/Parent build-install-run checks on emulator.","status":"closed","priority":3,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-11T20:47:04.364766+08:00","created_by":"kexuejin","updated_at":"2026-02-12T00:28:51.221767+08:00","closed_at":"2026-02-12T00:28:51.221767+08:00","close_reason":"pack.py main workflow split into testable helper units with regression coverage; verified build/install/runtime pipeline on emulator.","labels":["maintainability","packer","test"],"dependencies":[{"issue_id":"android-shell-7so.7","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T20:47:04.3656+08:00","created_by":"kexuejin"},{"issue_id":"android-shell-7so.7","depends_on_id":"android-shell-7so.1","type":"blocks","created_at":"2026-02-11T20:48:08.730552+08:00","created_by":"kexuejin"},{"issue_id":"android-shell-7so.7","depends_on_id":"android-shell-7so.2","type":"blocks","created_at":"2026-02-11T20:48:08.83518+08:00","created_by":"kexuejin"},{"issue_id":"android-shell-7so.7","depends_on_id":"android-shell-7so.6","type":"blocks","created_at":"2026-02-11T20:48:08.940197+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.8","title":"修复 BootstrapProvider authorities 冲突导致双包无法共存","description":"当前 provider authorities 被写成字面量 .kapp-bootstrap，导致不同包安装时冲突（INSTALL_FAILED_CONFLICTING_PROVIDER）。应使用真实包名派生唯一 authorities。","notes":"Root-cause fix in pack.py: BootstrapProvider authorities now derived from target package name; proceeding with rebuild and dual-install verification.\nValidation (2026-02-11): built /tmp/protected-kid-bead8.apk and /tmp/protected-parent-bead8.apk; installed both without uninstalling each other (adb install --no-incremental -r both success). dumpsys confirms unique authorities: com.example.kidapp.kapp-bootstrap and com.example.parentapp.kapp-bootstrap. INSTALL_FAILED_CONFLICTING_PROVIDER no longer reproduced.","status":"closed","priority":1,"issue_type":"bug","owner":"kexuejin@gmail.com","created_at":"2026-02-11T21:19:45.651945+08:00","created_by":"kexuejin","updated_at":"2026-02-11T23:20:28.855032+08:00","closed_at":"2026-02-11T23:20:28.855032+08:00","close_reason":"Fixed provider authorities derivation in pack.py and verified dual-package coexistence install on emulator.","labels":["installer","manifest"],"dependencies":[{"issue_id":"android-shell-7so.8","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T21:19:45.653037+08:00","created_by":"kexuejin"}]}
{"id":"android-shell-7so.9","title":"修复 --skip-build 路径下 payload/key 可能失配","description":"pack.py 在 --skip-build 时，phase1 可能使用旧 packer 二进制生成 payload，随后重新编译 shell/packer 导致 key 与 payload 不一致，运行期解密失败。","notes":"Starting root-cause investigation for payload/key mismatch in --skip-build path with reproducible checks.\nImplemented skip-build key consistency fix in pack.py: added select_key_bytes() to reuse existing packer key from packer/src/config.rs when --skip-build is enabled, instead of always generating a random key. Added regression tests in scripts/test_pack_skip_build.py (fail-before/pass-after) and verified with python3 -m unittest scripts/test_pack_skip_build.py.\nValidation (2026-02-11): built --skip-build artifacts /tmp/protected-kid-skipbuild-fix.apk and /tmp/protected-parent-skipbuild-fix.apk; both install successfully on emulator with --no-incremental. Kid launches without FATAL/ANR in filtered logs.","status":"closed","priority":1,"issue_type":"bug","owner":"kexuejin@gmail.com","created_at":"2026-02-11T21:50:06.879965+08:00","created_by":"kexuejin","updated_at":"2026-02-11T23:32:40.063469+08:00","closed_at":"2026-02-11T23:32:40.063469+08:00","close_reason":"--skip-build now reuses existing packer key to prevent payload/key mismatch; covered by regression tests and emulator build/install verification.","labels":["build","packer"],"dependencies":[{"issue_id":"android-shell-7so.9","depends_on_id":"android-shell-7so","type":"parent-child","created_at":"2026-02-11T21:50:06.881316+08:00","created_by":"kexuejin"}]}
{"id":"android-t4d","title":"Normalize relative component class names in shell loader","description":"Normalize metadata/appinfo class names (leading-dot and short names) before class loading in ShellApplication and ShellComponentFactory for complex targets.","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T09:57:51.892178+08:00","created_by":"kexuejin","updated_at":"2026-02-13T10:04:10.558075+08:00","closed_at":"2026-02-13T10:04:10.558075+08:00","close_reason":"Normalized relative metadata/appinfo class names in shell loader; validated by tests and emulator packaging/install runs"}
{"id":"android-ul6","title":"建立kapp复杂fixture并完成加固验证","notes":"完成内容：1) 新增 fixtures/test-apps 下 kappa/kappb 两个内部测试应用（kappb 覆盖第三方库、自定义 Application、native so、activity-alias/provider/service/receiver）；2) 新增 scripts/build_fixture_apps.sh 与 scripts/harden_fixture_apps.sh；3) 清理旧测试命名残留并更新 README 与 scripts/test_on_emulator.sh；4) 修复 .gitignore 允许跟踪 CMakeLists.txt。\\n验证：scripts/build_fixture_apps.sh；scripts/harden_fixture_apps.sh；模拟器验证通过：/tmp/protected-kappa-debug.apk、/tmp/protected-kappb-debug.apk、/tmp/protected-kappb-release.apk（log: /tmp/kappa-validate.log, /tmp/kappb-debug-validate.log, /tmp/kappb-release-validate.log）。","status":"closed","priority":1,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T07:04:10.934882+08:00","created_by":"kexuejin","updated_at":"2026-02-13T07:06:03.443942+08:00","closed_at":"2026-02-13T07:05:09.332221+08:00","close_reason":"implemented and validated on emulator"}
{"id":"android-zti","title":"Deduplicate shell component name normalization","description":"Extract shared component-class name normalization utility and use it in ShellApplication and ShellComponentFactory to avoid drift.","status":"closed","priority":2,"issue_type":"task","owner":"kexuejin@gmail.com","created_at":"2026-02-13T10:18:25.193757+08:00","created_by":"kexuejin","updated_at":"2026-02-13T10:21:19.329873+08:00","closed_at":"2026-02-13T10:21:19.329873+08:00","close_reason":"Extracted shared shell component-name normalizer and updated callers/tests; validated with tests and emulator packaging/install checks"}
